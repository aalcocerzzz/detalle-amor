<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Te Amo - Rompecabezas Interactivo</title>
<link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;600;700&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
  *{box-sizing:border-box;margin:0;padding:0}
  body{
    background: linear-gradient(135deg,#fddde6 0%,#f8c8d6 50%,#fddde6 100%);
    min-height:100vh;font-family:'Poppins',sans-serif;display:flex;align-items:center;justify-content:center;
    overflow-x:hidden;position:relative;padding:18px;
  }
  .container{display:flex;width:95%;max-width:1200px;gap:40px;align-items:center;justify-content:center;flex-wrap:wrap;}
  .puzzle-section{flex:1;min-width:300px;max-width:500px;}
  .title{font-family:'Dancing Script',cursive;font-size:3rem;color:#d63384;text-align:center;margin-bottom:18px;animation:pulse 2s infinite alternate}
  @keyframes pulse{from{transform:scale(1)}to{transform:scale(1.02)}}
  .puzzle-container{background:#fff;border-radius:20px;padding:22px;box-shadow:0 15px 35px rgba(214,51,132,0.25);position:relative}
  .puzzle-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;width:300px;height:300px;margin:0 auto 20px;padding:15px;border-radius:15px;border:3px dashed #d63384;background:#f8f9fa}
  .puzzle-slot{background:linear-gradient(135deg,#fff 0%,#f8f9fa 100%);border:2px solid #e9ecef;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:2rem;font-weight:600;color:#d63384;transition:all .3s}
  .puzzle-slot.highlight{border-color:#d63384;transform:scale(1.04);background:linear-gradient(135deg,#fff5f8 0%,#ffe8f0 100%)}
  .pieces-container{display:grid;grid-template-columns:repeat(3,1fr);gap:15px;width:300px;margin:0 auto}
  .puzzle-piece{width:80px;height:80px;background:linear-gradient(135deg,#d63384 0%,#e85aa0 100%);border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:1.8rem;font-weight:700;color:#fff;cursor:move;box-shadow:0 8px 20px rgba(214,51,132,0.4);user-select:none;position:relative;border:3px solid rgba(255,255,255,0.3)}
  .puzzle-piece.dragging{opacity:.85;transform:rotate(4deg) scale(1.06);z-index:999}
  .message-display{background:rgba(255,255,255,0.95);border-radius:20px;padding:30px 24px;box-shadow:0 15px 35px rgba(214,51,132,0.18);text-align:center}
  .current-message{font-family:'Dancing Script',cursive;font-size:2.5rem;color:#d63384;min-height:90px;display:flex;align-items:center;justify-content:center;animation:fadeInOut 3s ease-in-out infinite}
  @keyframes fadeInOut{0%,100%{opacity:.7;transform:scale(.98)}50%{opacity:1;transform:scale(1.02)}}
  .language-name{font-size:1rem;color:#6c757d;margin-top:6px}
  .completion-message{font-family:'Dancing Script',cursive;font-size:2rem;color:#d63384;text-align:center;margin-top:18px;opacity:0;transform:translateY(20px);transition:all .5s}
  .completion-message.show{opacity:1;transform:translateY(0)}
  .floating-hearts{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:500}
  .floating-heart{position:absolute;color:#ff69b4;font-size:2rem;animation:floatUp 3s ease-out forwards;opacity:0}
  @keyframes floatUp{0%{opacity:1;transform:translateY(0) scale(1)}100%{opacity:0;transform:translateY(-100px) scale(.5)}}
  .sparkle{position:absolute;font-size:1.5rem;pointer-events:none;animation:sparkleAnimation 1s ease-out forwards}
  @keyframes sparkleAnimation{0%{opacity:0;transform:scale(0)}50%{opacity:1;transform:scale(1.2) rotate(180deg)}100%{opacity:0;transform:scale(.8) rotate(360deg)}}

  #bigPlayOverlay{
    position:fixed; left:0; top:0; width:100%; height:100%; display:flex; align-items:center; justify-content:center;
    background: rgba(0,0,0,0.45); z-index:2000; transition:opacity .25s;
  }
  #bigPlayOverlay.hidden{ opacity:0; pointer-events:none; display:none; }
  #bigPlayBtn{
    background: linear-gradient(90deg,#ff6aa9,#d63384);
    color:white; font-weight:800; font-size:1.2rem; padding:20px 28px; border-radius:16px; border:none;
    box-shadow:0 12px 30px rgba(214,51,132,0.25); cursor:pointer; display:flex; gap:12px; align-items:center;
  }
  #bigPlayBtn .note { font-size:0.85rem; opacity:0.95; }

  @media (max-width:768px){ .puzzle-grid{width:250px;height:250px} .pieces-container{width:250px} .puzzle-piece{width:65px;height:65px;font-size:1.5rem} .title{font-size:2.2rem}}
</style>
</head>
<body>
  <div class="floating-hearts" id="floatingHearts"></div>

  <div class="container">
    <div class="puzzle-section">
      <h1 class="title">Arma el Mensaje üíï</h1>
      <div class="puzzle-container">
        <div class="puzzle-grid" id="puzzleGrid"></div>
        <div class="pieces-container" id="piecesContainer"></div>
        <div class="completion-message" id="completionMessage">‚ú® ¬°Te amo mucho Yhibel! ‚ú®</div>
      </div>
    </div>

    <div class="love-messages">
      <div class="message-display">
        <div class="current-message" id="loveMessage">Te Amo</div>
        <div class="language-name" id="languageName">Espa√±ol</div>
      </div>
    </div>
  </div>

  <div class="cat-container" style="position:fixed;bottom:30px;right:30px;z-index:1000">
    <div class="cat" style="width:80px;height:80px;background:#fff;border-radius:50% 50% 45% 45%;box-shadow:0 8px 20px rgba(0,0,0,.18);animation:float 3s ease-in-out infinite;position:relative">
      <div class="cat-eyes" style="position:absolute;top:25px;left:50%;transform:translateX(-50%);display:flex;gap:8px">
        <div class="eye" style="width:8px;height:12px;background:#333;border-radius:50%;animation:blink 3s infinite"></div>
        <div class="eye" style="width:8px;height:12px;background:#333;border-radius:50%;animation:blink 3s infinite"></div>
      </div>
      <div class="cat-mouth" style="position:absolute;bottom:20px;left:50%;transform:translateX(-50%);width:6px;height:6px;background:#ff69b4;border-radius:50%"></div>
    </div>
    <div class="speech-bubble" id="speechBubble" style="position:absolute;bottom:100px;right:-20px;background:white;padding:12px 16px;border-radius:16px;box-shadow:0 5px 15px rgba(0,0,0,.12);color:#d63384;font-weight:500;opacity:0;transform:translateY(10px);transition:all .3s">¬°Hola mi amor! üíï</div>
  </div>

  <div id="bigPlayOverlay" role="dialog" aria-modal="true">
    <button id="bigPlayBtn" aria-label="Tocar m√∫sica">
      ‚ñ∂Ô∏è  Reproducir "Photograph"
      <span class="note"> (click para escuchar en segundo plano)</span>
    </button>
  </div>

  <audio id="bgAudio" autoplay loop>
    <source src="audio/photograph.mp3" type="audio/mpeg">
  </audio>
 
<script>
const puzzleData = [
  { letter: 'T', number: 2, position: 0 },
  { letter: 'E', number: 7, position: 1 },
  { letter: '‚ô•', number: 8, position: 2 },
  { letter: 'A', number: 3, position: 3 },
  { letter: 'M', number: 0, position: 4 },
  { letter: 'O', number: 3, position: 5 },
  { letter: '‚ô•', number: '‚ô•', position: 6 },
  { letter: '‚ô•', number: '‚ô•', position: 7 },
  { letter: '‚ô•', number: '‚ô•', position: 8 }
];

const catMessages = ["Eres hermosa","Te quiero mucho","Eres mi pedacito de cielo","Contigo todo es mejor","Mi amorcito lindo","Eres lo mejor que me pas√≥","Miau miau, te amo üíï"];

const loveLanguages = [
  { message: "Te Amo", language: "Espa√±ol" },
  { message: "I Love You", language: "English" },
  { message: "Je t'aime", language: "Fran√ßais" },
  { message: "Ti Amo", language: "Italiano" },
  { message: "Eu te amo", language: "Portugu√™s" },
  { message: "Ich liebe dich", language: "Deutsch" },
  { message: "ÊÑõ„Åó„Å¶„Çã", language: "Êó•Êú¨Ë™û" },
  { message: "ÏÇ¨ÎûëÌï¥", language: "ÌïúÍµ≠Ïñ¥" },
  { message: "–Ø —Ç–µ–±—è –ª—é–±–ª—é", language: "–†—É—Å—Å–∫–∏–π" },
  { message: "ÿ£ÿ≠ÿ®ŸÉ", language: "ÿßŸÑÿπÿ±ÿ®Ÿäÿ©" },
  { message: "ÊàëÁà±‰Ω†", language: "‰∏≠Êñá" },
  { message: "S'agapo", language: "ŒïŒªŒªŒ∑ŒΩŒπŒ∫Œ¨" },
  { message: "Ik hou van jou", language: "Nederlands" },
  { message: "Kocham ciƒô", language: "Polski" },
  { message: "Te iubesc", language: "Rom√¢nƒÉ" },
  { message: "Mahal kita", language: "Tagalog" },
  { message: "–Ø –∫–æ—Ö–∞—é —Ç–µ–±–µ", language: "–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞" },
  { message: "Te dua", language: "Shqip" },
  { message: "A≈° tave myliu", language: "Lietuvi≈≥" },
  { message: "Szeretlek", language: "Magyar" },
  { message: "Ani ohev otach", language: "◊¢◊ë◊®◊ô◊™" },
  { message: "ÊÑõ„Åó„Å¶„Åæ„Åô", language: "Êó•Êú¨Ë™û (formal)" },
  { message: "Naku penda", language: "Swahili" }
];

let currentLanguageIndex = 0;
let draggedPiece = null;
let completedPieces = 0;
let isCompleted = false;

const bgAudio = document.getElementById('bgAudio');

function initGame(){
  createPuzzleSlots();
  createPuzzlePieces();
  startCatMessages();
  startLanguageRotation();

  document.getElementById('bigPlayBtn').addEventListener('click', async (e) => {
    e.preventDefault();
    e.stopPropagation();
    await tryStartBackgroundMusicOnce(true);
  });

  document.addEventListener('dragstart', () => tryStartBackgroundMusicOnce(), { once:true, passive:true });
}

function createPuzzleSlots(){
  const grid = document.getElementById('puzzleGrid'); grid.innerHTML='';
  for(let i=0;i<9;i++){
    const slot=document.createElement('div');
    slot.className='puzzle-slot'; slot.dataset.position=i;
    slot.addEventListener('dragover',handleDragOver);
    slot.addEventListener('drop',handleDrop);
    slot.addEventListener('dragenter',handleDragEnter);
    slot.addEventListener('dragleave',handleDragLeave);
    grid.appendChild(slot);
  }
}

function createPuzzlePieces(){
  const container=document.getElementById('piecesContainer');
  container.innerHTML='';
  const shuffled=[...puzzleData].sort(()=>Math.random()-0.5);
  shuffled.forEach(piece=>{
    const el=document.createElement('div');
    el.className='puzzle-piece'; el.draggable=true; el.dataset.position=piece.position;
    el.textContent=piece.number;
    el.addEventListener('dragstart',handleDragStart);
    el.addEventListener('dragend',handleDragEnd);
    
    // üëá soporte para arrastrar con el dedo en celular
    el.addEventListener('touchstart', handleTouchStart, {passive:false});
    el.addEventListener('touchmove', handleTouchMove, {passive:false});
    el.addEventListener('touchend', handleTouchEnd, {passive:false});
    
    container.appendChild(el);
  });
  completedPieces=0; isCompleted=false;
  document.getElementById('completionMessage').classList.remove('show');
}

// funciones touch
let touchPiece = null;
function handleTouchStart(e){
  e.preventDefault();
  touchPiece = e.target;
  touchPiece.classList.add('dragging');
}
function handleTouchMove(e){
  if(!touchPiece) return;
  e.preventDefault();
  const touch = e.touches[0];
  touchPiece.style.position = 'fixed';
  touchPiece.style.left = (touch.clientX - 40) + 'px';
  touchPiece.style.top = (touch.clientY - 40) + 'px';
}
function handleTouchEnd(e){
  if(!touchPiece) return;
  const slots = document.querySelectorAll('.puzzle-slot');
  const rectPiece = touchPiece.getBoundingClientRect();
  let dropped = false;
  slots.forEach(slot=>{
    const r = slot.getBoundingClientRect();
    if(rectPiece.left < r.right && rectPiece.right > r.left && rectPiece.top < r.bottom && rectPiece.bottom > r.top){
      handleDrop({target:slot, preventDefault:()=>{}});
      dropped = true;
    }
  });
  if(!dropped){
    touchPiece.style.position='static';
  }
  touchPiece.classList.remove('dragging');
  touchPiece = null;
}

function handleDragStart(e){ draggedPiece=e.target; e.target.classList.add('dragging'); tryStartBackgroundMusicOnce(); }
function handleDragEnd(e){ e.target.classList.remove('dragging'); draggedPiece=null; }
function handleDragOver(e){ e.preventDefault(); }
function handleDragEnter(e){ e.preventDefault(); if(e.target.classList) e.target.classList.add('highlight'); }
function handleDragLeave(e){ if(e.target.classList) e.target.classList.remove('highlight'); }
function handleDrop(e){
  e.preventDefault();
  if(e.target.classList) e.target.classList.remove('highlight');
  const piece = draggedPiece || touchPiece;
  if(!piece) return;
  const dropPos = parseInt(e.target.dataset.position);
  const piecePos = parseInt(piece.dataset.position);
  if(dropPos===piecePos){
    e.target.appendChild(piece);
    piece.style.position='static';
    piece.draggable=false;
    completedPieces++;
    if(completedPieces===9) setTimeout(()=>revealLetters(),500);
  }
}

function revealLetters(){
  const slots=document.querySelectorAll('.puzzle-slot');
  slots.forEach((slot,index)=>{
    setTimeout(()=>{
      const piece = slot.querySelector('.puzzle-piece');
      if(piece){
        const correctLetter = puzzleData.find(p=>p.position===index).letter;
        piece.textContent = correctLetter;
      }
    }, index*300);
  });
  setTimeout(()=>{
    document.getElementById('completionMessage').classList.add('show');
  }, 9*300 + 500);
}

function startCatMessages(){
  function showRandomMessage(){
    const bubble = document.getElementById('speechBubble');
    const randomMessage = catMessages[Math.floor(Math.random()*catMessages.length)];
    bubble.textContent = randomMessage; bubble.classList.add('show');
    setTimeout(()=>bubble.classList.remove('show'),3000);
  }
  setTimeout(showRandomMessage,2000);
  setInterval(()=>{ if(Math.random()>0.3) showRandomMessage(); }, 8000);
}

function startLanguageRotation(){
  setInterval(()=>{
    const cur = loveLanguages[currentLanguageIndex];
    document.getElementById('loveMessage').textContent = cur.message;
    document.getElementById('languageName').textContent = cur.language;
    currentLanguageIndex = (currentLanguageIndex+1) % loveLanguages.length;
  }, 3000);
}

let musicAttempted = false;
function hideOverlayIfPlaying(){
  try {
    if(bgAudio && !bgAudio.paused){
      document.getElementById('bigPlayOverlay').classList.add('hidden');
    }
  } catch(e){}
}
function showOverlay(){ document.getElementById('bigPlayOverlay').classList.remove('hidden'); }
function hideOverlay(){ document.getElementById('bigPlayOverlay').classList.add('hidden'); }

async function tryStartBackgroundMusicOnce(forced = false){
  if(musicAttempted && !forced) return;
  musicAttempted = true;
  if(!bgAudio) {
    showOverlay();
    return;
  }
  bgAudio.currentTime = 0;
  bgAudio.volume = 0.7;
  try {
    const p = bgAudio.play();
    if(p && typeof p.then === 'function'){ await p; }
    hideOverlay();
  } catch(err){ showOverlay(); }
}

document.addEventListener('DOMContentLoaded', () => {
  initGame();
  showOverlay();
  setInterval(hideOverlayIfPlaying, 800);
});
</script>
</body>
</html>
